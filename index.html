<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鳴潮 音骸スコアチェッカー</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>🎮 鳴潮 音骸スコアチェッカー</h1>
            <p class="subtitle">スクリーンショットを貼り付けてスコアを計算</p>
        </header>

        <main>
            <!-- 操作ガイド -->
            <section class="guide-section">
                <h2>使い方</h2>
                <ol class="guide-steps">
                    <li>ゲーム画面のスクリーンショット（FHD 1920x1080）を撮る</li>
                    <li>スクショをコピー（Ctrl+C）</li>
                    <li>下のエリアに貼り付け（Ctrl+V）</li>
                    <li>自動で音骸のステータスが認識され、スコアが計算されます</li>
                </ol>
            </section>

            <!-- 設定パネル -->
            <section class="settings-panel">
                <div class="settings-toggle">
                    <button id="settingsBtn" class="settings-btn">⚙️ 高度な設定</button>
                </div>
                <div id="settingsContent" class="settings-content" style="display: none;">
                    <div class="settings-group">
                        <h3>画像処理パラメータ</h3>
                        <div class="setting-item">
                            <label>クロップ開始位置（X軸）: <span id="cropXValue">65</span>%</label>
                            <input type="range" id="cropX" min="0" max="100" value="65" step="5">
                        </div>
                        <div class="setting-item">
                            <label>クロップ開始位置（Y軸）: <span id="cropYValue">15</span>%</label>
                            <input type="range" id="cropY" min="0" max="100" value="15" step="5">
                        </div>
                        <div class="setting-item">
                            <label>クロップ幅: <span id="cropWValue">30</span>%</label>
                            <input type="range" id="cropW" min="10" max="50" value="30" step="5">
                        </div>
                        <div class="setting-item">
                            <label>クロップ高さ: <span id="cropHValue">70</span>%</label>
                            <input type="range" id="cropH" min="20" max="100" value="70" step="5">
                        </div>
                    </div>

                    <div class="settings-group">
                        <h3>スコア計算の重み調整</h3>
                        <div class="setting-item">
                            <label>攻撃力: <span id="weightAttackValue">1.0</span></label>
                            <input type="range" id="weightAttack" min="0" max="3" value="1.0" step="0.1">
                        </div>
                        <div class="setting-item">
                            <label>会心率: <span id="weightCriRateValue">2.0</span></label>
                            <input type="range" id="weightCriRate" min="0" max="5" value="2.0" step="0.1">
                        </div>
                        <div class="setting-item">
                            <label>会心ダメージ: <span id="weightCriDmgValue">1.0</span></label>
                            <input type="range" id="weightCriDmg" min="0" max="3" value="1.0" step="0.1">
                        </div>
                    </div>

                    <div class="settings-action">
                        <button id="resetSettingsBtn" class="btn btn-secondary">デフォルトに戻す</button>
                    </div>
                </div>
            </section>

            <!-- 画像入力エリア -->
            <section class="input-section">
                <div id="dropzone" class="dropzone" tabindex="0" role="button" aria-label="スクリーンショット貼り付け/ドロップエリア">
                    <div class="dropzone-content">
                        <p class="dropzone-icon">📋</p>
                        <p class="dropzone-text">ここにスクリーンショットを貼り付けてください</p>
                        <p class="dropzone-hint">（Ctrl+Vで貼り付け）</p>
                        <div class="dropzone-actions">
                            <button id="pasteBtn" class="btn btn-secondary" title="クリップボードから画像を読み取る">貼り付けボタン</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ローディング表示 -->
            <div id="loading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>画像を処理中...</p>
            </div>

            <!-- 画像プレビュー -->
            <section id="preview-section" class="preview-section" style="display: none;">
                <h2>画像プレビュー</h2>
                <div class="preview-container">
                    <div class="preview-item">
                        <h3>元の画像</h3>
                        <canvas id="originalCanvas" class="preview-canvas"></canvas>
                    </div>
                    <div class="preview-item">
                        <h3>クロップ領域</h3>
                        <canvas id="croppedCanvas" class="preview-canvas"></canvas>
                    </div>
                    <div class="preview-item">
                        <h3>処理済み画像</h3>
                        <canvas id="processedCanvas" class="preview-canvas"></canvas>
                    </div>
                </div>
            </section>

            <!-- 認識結果 -->
            <section id="results-section" class="results-section" style="display: none;">
                <h2>認識されたステータス</h2>
                <div class="status-grid" id="statusGrid">
                    <!-- JavaScriptで動的に生成 -->
                </div>
            </section>

            <!-- スコア結果 -->
            <section id="score-section" class="score-section" style="display: none;">
                <h2>計算結果</h2>
                <div class="score-card">
                    <div class="score-value" id="scoreValue">0</div>
                    <div class="score-label">総合スコア</div>
                </div>
                
                <div class="score-breakdown">
                    <h3>スコア内訳</h3>
                    <div id="scoreBreakdown" class="breakdown-list">
                        <!-- JavaScriptで動的に生成 -->
                    </div>
                </div>

                <div class="action-buttons">
                    <button id="resetBtn" class="btn btn-primary">リセット</button>
                    <button id="downloadBtn" class="btn btn-secondary">結果をダウンロード</button>
                    <button id="saveHistoryBtn" class="btn btn-secondary">履歴に保存</button>
                </div>
            </section>

            <!-- エラーメッセージ -->
            <div id="errorMessage" class="error-message" style="display: none;"></div>

            <!-- 履歴セクション -->
            <section id="history-section" class="history-section" style="display: none;">
                <h2>📜 過去の結果</h2>
                <div class="history-controls">
                    <button id="clearHistoryBtn" class="btn btn-secondary">履歴をクリア</button>
                </div>
                <div id="historyList" class="history-list">
                    <!-- JavaScriptで動的に生成 -->
                </div>
            </section>

        </main>

        <footer>
            <p>© 2025 鳴潮 音骸スコアチェッカー | OpenCV.js + Tesseract.js</p>
            <p class="footer-info">
                <a href="https://github.com" target="_blank">GitHub</a> |
                <a href="#" id="aboutLink">使い方</a>
            </p>
        </footer>
    </div>

    <!-- OpenCV.js (CDN: unpkgに変更してCORS/MIME問題を回避) -->
    <script async crossorigin="anonymous" src="https://unpkg.com/@techstark/opencv-js@4.7.0/dist/opencv.js"></script>

    <!-- Tesseract.js (ローカルに固定) -->
    <script src="assets/tesseract/tesseract.min.js"></script>

    <!-- メイン処理スクリプト -->
    <script src="script.js"></script>
    <!-- 簡易favicon（404抑制） -->
    <link rel="icon" href="data:,">
</body>
</html>
