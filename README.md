# 🎮 鳴潮 音骸スコア計算機 (3エリア認識対応版)

## 📋 概要
画像をペーストするだけで、ゲームアイテムのスコアを自動計算するツールです 
**OpenCV.js + Tesseract.js** のハイブリッド方式で高精度なOCR認識を実現し、  
**3エリア認識システム**により、計算に含めるステータスと除外するステータスを自動で判別します。

## 🚀 新機能: 3エリア認識システム

### 📊 認識エリアの分割
1. **🏷️ エリア1 (音骸名前)** - 赤枠  
   - 音骸の名前を認識
   - 金色/白色のテキストに最適化

2. **🚫 エリア2 (除外ステータス)** - オレンジ枠  
   - 計算から除外するステータス
   - メイン効果やセット効果など

3. **✅ エリア3 (計算対象ステータス)** - 緑枠  
   - スコア計算に含めるステータス  
   - サブステータス中心

### 🎯 利点
- **精度向上**: 領域を分けることで誤認識を削減
- **柔軟な計算**: 必要なステータスのみを計算対象にできる
- **視覚的理解**: 色分けされたエリアで認識状況が分かりやすい

## 🔧 OpenCVの実際の利用状況

### ✅ **現在使用中の機能**
- **モルフォロジー処理**: 文字の補強とノイズ除去
- **輪郭検出**: テキスト領域の自動検出
- **ROI抽出**: 関心領域の効率的な切り出し
- **基本画像操作**: Mat ↔ Canvas変換

### 🔄 **部分実装済み**
- **テンプレートマッチング**: フレームワーク準備済み（実装途中）
- **色空間フィルタリング**: HSV変換による文字色抽出

### 📈 **今後の拡張予定**
- **高度なテンプレートマッチング**: 文字パターンの事前学習
- **適応的閾値処理**: 背景に応じた動的な前処理
- **多段階輪郭解析**: より精密な領域検出

## 📊 パフォーマンス分析

### 🎯 **認識方式の優先順位**
1. **3エリア認識 (three_area_hybrid)** - 最高精度
2. **ハイブリッド方式 (hybrid)** - 高精度・高速
3. **従来方式 (fallback)** - 基本認識

### ⚡ **処理速度**
- 3エリア認識: 3-5秒 (高精度重視)
- ハイブリッド方式: 2-3秒 (バランス)
- 従来方式: 1-2秒 (速度重視)

## 🎮 対応ゲーム

| ゲーム | 3エリア対応 | 項目 | 特徴 |
|--------|-------------|------|------|
| 🌊 **鳴潮** | ✅ | 音骸 | 金色テキスト最適化 |
| 🔥 **原神** | 🔄 準備中 | 聖遺物 | 白色テキスト対応 |
| ⭐ **崩壊：スターレイル** | 🔄 準備中 | 遺物 | 青色テキスト対応 |

## 🛠️ 技術スタック

### 🧠 **コア技術**
- **OpenCV.js 4.x**: ブラウザ版コンピュータビジョン
- **Tesseract.js 5.x**: JavaScript OCRエンジン
- **Fuse.js**: ファジィ文字列マッチング
- **TailwindCSS**: レスポンシブUI

### 🎨 **画像処理パイプライン**
```
📸 画像入力
  ↓
🎯 3エリア分割
  ↓
🎨 ゲーム固有前処理 (HSV色空間)
  ↓  
🔍 OpenCV輪郭検出
  ↓
📝 Tesseract OCR (並列処理)
  ↓
🧮 スコア計算 & 結果表示
```

## 📁 ファイル構成

```
📂 Wuthering-Waves-score/
├── 📄 index.html          # メインUI (ダークテーマ)
├── 📄 app.js             # アプリケーション制御
├── 📄 hybrid-ocr.js      # 3エリア認識システム
├── 📄 config.js          # ゲーム設定とビルド情報
├── 📄 style.css          # スタイル定義
└── 📄 README.md          # このファイル
```

## 🎯 使用方法

### 1️⃣ **基本操作**
1. ブラウザでindex.htmlを開く
2. ゲーム種類を選択
3. キャラクタービルドを選択  
4. 音骸スクリーンショットをCtrl+Vでペースト
5. 3エリア認識の結果を確認

### 2️⃣ **3エリア認識の確認**
- **赤枠**: 音骸名前が正しく認識されているか
- **オレンジ枠**: 除外するステータスが含まれているか
- **緑枠**: 計算したいステータスが含まれているか

### 3️⃣ **結果の解釈**
- **除外セクション**: 🚫マークの項目は計算対象外
- **計算セクション**: ✅マークの項目でスコアを算出
- **統計情報**: 認識精度と項目数を確認

## 🔧 カスタマイズ

### 🎮 **新ゲーム追加**
`config.js`にゲーム設定を追加:
```javascript
"新ゲーム": {
  "three_area_recognition": {
    "item_name_area": [x1, y1, width1, height1],
    "excluded_stats_area": [x2, y2, width2, height2], 
    "included_stats_area": [x3, y3, width3, height3]
  },
  "character_builds": { /* ビルド設定 */ }
}
```

### 👤 **新キャラクター追加**
既存ゲームに新しいビルドを追加:
```javascript
"新キャラ": {
  "main": { "メイン効果": 1 },
  "sub": { "サブ効果": 1.0, "優先度低": 0.5 }
}
```

## 🐛 トラブルシューティング

### ❌ **認識精度が低い場合**
1. **画像品質を確認**:
   - 解像度: 1920x1080以上推奨
   - フォーマット: PNG > JPG
   - 圧縮: 無圧縮推奨

2. **エリア調整**:
   - F12で開発者ツールを開く
   - コンソールで座標を確認
   - `config.js`のエリア設定を微調整

3. **OCR設定調整**:
   - `threshold`値を調整 (128-200)
   - `tessedit_char_whitelist`に文字を追加

### ⚠️ **エラー対応**
- **OpenCV読み込み失敗**: ネット接続確認、CDN変更
- **Tesseract初期化エラー**: ブラウザキャッシュクリア
- **計算エラー**: キャラクタービルド設定確認

## 📈 パフォーマンス最適化

### 🚀 **高速化設定**
```javascript
// hybrid-ocr.js
const PERFORMANCE_MODE = {
  scale: 2.0,        // 3.0→2.0で高速化
  parallel: true,    // 並列処理有効
  cache: true        // 結果キャッシュ
};
```

### 💾 **メモリ最適化**
- 大きな画像は自動リサイズ
- 処理後のMatオブジェクトは自動削除
- ブラウザキャッシュを活用

## 🌟 今後の開発予定

### 🎯 **短期目標**
- [ ] 原神・スターレイルの3エリア対応
- [ ] テンプレートマッチングの完全実装  
- [ ] 認識精度の統計分析機能

### 🚀 **長期目標**
- [ ] 機械学習による認識精度向上
- [ ] リアルタイムビデオ認識
- [ ] モバイルアプリ版開発

---

## 📞 サポート
- バグ報告: GitHub Issues
- 機能要望: Discussions
- 技術質問: Wiki
